<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MayaMind</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #0a0a10;
      color: #e0e0e0;
      font-family: system-ui, -apple-system, sans-serif;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* â”€â”€ Avatar canvas â”€â”€ */
    #avatar {
      flex: 1;
      width: 100%;
      min-height: 0;
      position: relative;
    }
    #avatar canvas { width: 100% !important; height: 100% !important; }

    /* Loading overlay */
    #loading {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0a0a10;
      color: #555;
      font-size: 14px;
      z-index: 10;
      transition: opacity 0.6s;
    }
    #loading.hidden { opacity: 0; pointer-events: none; }

    /* Start overlay â€” required for Chrome AudioContext user-gesture policy.
       One click here un-suspends the AudioContext for the entire session. */
    #start-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(10,10,16,0.72);
      backdrop-filter: blur(4px);
      cursor: pointer;
      z-index: 9;
      transition: opacity 0.4s;
    }
    #start-overlay.hidden { opacity: 0; pointer-events: none; }

    #start-overlay .icon {
      font-size: 52px;
      margin-bottom: 16px;
      animation: float 2.5s ease-in-out infinite;
    }
    #start-overlay p {
      font-size: 18px;
      color: #ccc;
      letter-spacing: 0.02em;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50%       { transform: translateY(-8px); }
    }

    /* â”€â”€ Bottom HUD â”€â”€ */
    #hud {
      background: linear-gradient(to top, #0a0a10, rgba(10,10,16,0.92));
      padding: 10px 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 28vh;
      flex-shrink: 0;
    }

    /* â”€â”€ Status bar â”€â”€ */
    #status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    #status-left {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    /* Pulsing state dot */
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
      background: #444;
    }

    .dot.loading    { background: #555; }

    .dot.listening  {
      background: #4caf50;
      animation: pulse-green 1.6s ease-in-out infinite;
    }

    .dot.processing {
      background: #ff9800;
      animation: pulse-amber 0.8s ease-in-out infinite;
    }

    .dot.speaking   {
      background: #2196f3;
      animation: pulse-blue 1s ease-in-out infinite;
    }

    @keyframes pulse-green {
      0%, 100% { box-shadow: 0 0 0 0 rgba(76,175,80,0.6); }
      50%       { box-shadow: 0 0 0 6px rgba(76,175,80,0); }
    }
    @keyframes pulse-amber {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255,152,0,0.6); }
      50%       { box-shadow: 0 0 0 5px rgba(255,152,0,0); }
    }
    @keyframes pulse-blue {
      0%, 100% { box-shadow: 0 0 0 0 rgba(33,150,243,0.6); }
      50%       { box-shadow: 0 0 0 5px rgba(33,150,243,0); }
    }

    #status-text {
      font-size: 12px;
      color: #777;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    /* Mute button */
    #mute-btn {
      background: transparent;
      border: 1px solid #333;
      border-radius: 20px;
      color: #888;
      cursor: pointer;
      font-size: 16px;
      padding: 4px 10px;
      transition: border-color 0.2s, color 0.2s;
      flex-shrink: 0;
    }
    #mute-btn:hover:not(:disabled) { border-color: #555; color: #bbb; }
    #mute-btn.muted  { border-color: #8a1a1a; color: #e57373; }
    #mute-btn:disabled { opacity: 0.3; cursor: not-allowed; }

    /* â”€â”€ Transcript â”€â”€ */
    #transcript {
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 13px;
      min-height: 0;
    }

    .msg {
      padding: 5px 10px;
      border-radius: 8px;
      max-width: 85%;
      line-height: 1.45;
    }
    .msg.user      { background: #1e1e2e; color: #aaa; align-self: flex-end; }
    .msg.assistant { background: #0d2a45; color: #7db8e8; align-self: flex-start; }
    .msg.interim   { opacity: 0.5; font-style: italic; }

    /* â”€â”€ Settings button â”€â”€ */
    #settings-btn {
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 20;
      background: rgba(30,30,46,0.85);
      border: 1px solid #333;
      border-radius: 10px;
      color: #999;
      font-size: 20px;
      width: 40px;
      height: 40px;
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #settings-btn:hover { border-color: #555; color: #ddd; }

    /* â”€â”€ Settings panel â”€â”€ */
    #settings-overlay {
      position: fixed;
      inset: 0;
      z-index: 30;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(3px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    #settings-overlay.open { opacity: 1; pointer-events: auto; }

    #settings-panel {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 31;
      width: 320px;
      max-width: 90vw;
      height: 100dvh;
      background: #13131f;
      border-right: 1px solid #2a2a3a;
      overflow-y: auto;
      padding: 16px;
      transform: translateX(-100%);
      transition: transform 0.25s ease;
    }
    #settings-overlay.open + #settings-panel,
    #settings-panel.open { transform: translateX(0); }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .settings-header h3 { font-size: 16px; color: #ccc; font-weight: 500; }
    #settings-close {
      background: none;
      border: none;
      color: #777;
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
    }
    #settings-close:hover { color: #ddd; }

    .settings-section {
      margin-bottom: 14px;
    }
    .settings-section label {
      display: block;
      font-size: 11px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 6px;
    }

    /* Button group (pill chips) */
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .btn-group button {
      background: #1e1e2e;
      border: 1px solid #2a2a3a;
      border-radius: 6px;
      color: #888;
      font-size: 12px;
      padding: 5px 10px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-group button:hover { border-color: #444; color: #bbb; }
    .btn-group button.active {
      background: #1a3a5c;
      border-color: #2a6090;
      color: #8cc8ff;
    }

    /* Profile row */
    .profile-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .profile-row select {
      flex: 1;
      background: #1e1e2e;
      border: 1px solid #2a2a3a;
      border-radius: 6px;
      color: #aaa;
      font-size: 12px;
      padding: 5px 8px;
      outline: none;
    }
    .profile-row button {
      background: #1e1e2e;
      border: 1px solid #2a2a3a;
      border-radius: 6px;
      color: #888;
      font-size: 12px;
      padding: 5px 8px;
      cursor: pointer;
      white-space: nowrap;
    }
    .profile-row button:hover { border-color: #444; color: #bbb; }
    .profile-row button.danger:hover { border-color: #8a1a1a; color: #e57373; }
  </style>
</head>
<body>

  <!-- Settings gear button -->
  <button id="settings-btn" title="Settings">&#9881;</button>

  <!-- Settings overlay + panel -->
  <div id="settings-overlay"></div>
  <div id="settings-panel">
    <div class="settings-header">
      <h3>Settings</h3>
      <button id="settings-close">&#10005;</button>
    </div>

    <!-- Profile -->
    <div class="settings-section">
      <label>Profile</label>
      <div class="profile-row">
        <select id="profile-select"><option value="">-- No profile --</option></select>
        <button id="profile-save">Save</button>
        <button id="profile-delete" class="danger">Del</button>
      </div>
    </div>

    <!-- Camera View -->
    <div class="settings-section">
      <label>Camera View</label>
      <div class="btn-group" data-setting="cameraView">
        <button data-value="head">Head</button>
        <button data-value="upper">Upper Body</button>
        <button data-value="mid">Torso Up</button>
        <button data-value="full">Full Body</button>
      </div>
    </div>

    <!-- Background -->
    <div class="settings-section">
      <label>Background</label>
      <div class="btn-group" data-setting="background">
        <button data-value="default">Default</button>
        <button data-value="office">Office</button>
        <button data-value="living">Living Room</button>
        <button data-value="nature">Nature</button>
        <button data-value="city">City</button>
        <button data-value="beach">Beach</button>
      </div>
    </div>

    <!-- Mood -->
    <div class="settings-section">
      <label>Mood</label>
      <div class="btn-group" data-setting="mood">
        <button data-value="neutral">Neutral</button>
        <button data-value="happy">Happy</button>
        <button data-value="angry">Angry</button>
        <button data-value="sad">Sad</button>
        <button data-value="fear">Fear</button>
        <button data-value="disgust">Disgust</button>
        <button data-value="love">Love</button>
        <button data-value="sleep">Sleep</button>
        <button data-value="surprised">Surprised</button>
      </div>
    </div>

    <!-- Lighting -->
    <div class="settings-section">
      <label>Lighting</label>
      <div class="btn-group" data-setting="lighting">
        <button data-value="studio">Studio</button>
        <button data-value="warm">Warm</button>
        <button data-value="cool">Cool</button>
        <button data-value="dramatic">Dramatic</button>
        <button data-value="soft">Soft</button>
      </div>
    </div>

    <!-- Voice -->
    <div class="settings-section">
      <label>Voice</label>
      <div class="btn-group" data-setting="voice">
        <button data-value="21m00Tcm4TlvDq8ikWAM">Rachel &#9792;</button>
        <button data-value="EXAVITQu4vr4xnSDxMaL">Bella &#9792;</button>
        <button data-value="AZnzlk1XvdvUeBnXmlld">Domi &#9792;</button>
        <button data-value="TxGEqnHWrfWFTfGW9XjX">Josh &#9794;</button>
        <button data-value="VR6AewLTigWG4xSOukaG">Arnold &#9794;</button>
      </div>
    </div>
  </div>

  <div id="avatar">
    <div id="loading">Loading avatarâ€¦</div>
    <!-- Hidden until avatar is ready; click provides the user gesture Chrome requires -->
    <div id="start-overlay" class="hidden">
      <div class="icon">ðŸŽ¤</div>
      <p>Tap to start talking with Maya</p>
    </div>
  </div>

  <div id="hud">
    <div id="status-bar">
      <div id="status-left">
        <div id="status-dot" class="dot loading"></div>
        <span id="status-text">Initializingâ€¦</span>
      </div>
      <button id="mute-btn" disabled title="Mute mic">ðŸŽ¤</button>
    </div>
    <div id="transcript"></div>
  </div>

  <!-- Import map: tells the browser where to find bare module specifiers
       used by talkinghead.mjs (three, dompurify, marked).
       Versions must match what TalkingHead was built against. -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.180.0/build/three.module.js/+esm",
      "three/examples/": "https://cdn.jsdelivr.net/npm/three@0.180.0/examples/",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.180.0/examples/jsm/",
      "dompurify": "https://cdn.jsdelivr.net/npm/dompurify@3.1.7/+esm",
      "marked": "https://cdn.jsdelivr.net/npm/marked@14.1.3/+esm"
    }
  }
  </script>

  <script type="module" src="./app.js"></script>
</body>
</html>
